<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />

    <link rel="shortcut icon" href="../../../../_static/anomalib-favicon.png"/><meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>Simulation of production line with defects - Dataset creation and Inference - Anomalib v0.4.0</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Anomalib v0.4.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../../_static/anomalib-icon.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/training.html">Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/inference.html">Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/export.html">Export &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/benchmarking.html">Benchmarking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/hyperparameter_optimization.html">Hyperparameter Optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../index.html">How to Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../train_custom_data.html">Training with Custom Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../adding_a_new_model.html">Adding a New Model to Anomalib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/101_btech.html">Setting up the Working Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/101_btech.html#Use-BeanTech-Dataset-via-API">Use BeanTech Dataset via API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/102_mvtec.html">Use MVTec AD Dataset via API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/102_mvtec.html#Setting-up-the-Working-Directory">Setting up the Working Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/103_folder.html">Setting up the Working Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/103_folder.html#Use-Folder-Dataset-(for-Custom-Datasets)-via-API">Use Folder Dataset (for Custom Datasets) via API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/104_tiling.html">Setting up the Working Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../100_datamodules/104_tiling.html#Tiling-in-Anomalib-Training">Tiling in Anomalib Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html">Setting up the Working Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Imports">Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Data-Module">Data Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#FastFlow-Model">FastFlow Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Optimizer">Optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Callbacks">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Training">Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Inference">Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../200_models/201_fastflow.html#Visualization">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../300_benchmarking/301_benchmarking.html">Short walkthrough on Benchmarking in Anomalib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../300_benchmarking/302_hpo_wandb.html">Walkthrough on Hyperparameter Optimization using Weights and Biases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../400_openvino/nncf.html">Setting up the Working Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../400_openvino/nncf.html#1.-Standard-Training-without-NNCF">1. Standard Training without NNCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../400_openvino/nncf.html#2.-Training-with-NNCF">2. Training with NNCF</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../reference_guide/index.html">Reference Guide</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference_guide/api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/api/cli.html">CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/api/config.html">Configuration</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference_guide/api/data/index.html">Dataset</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/data/btech.html">Btech Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/data/mvtec.html">MVTec Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/data/folder.html">Folder Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/data/utils.html">Utils</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../reference_guide/api/model/index.html">Model</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/model/base.html">Base Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/model/dimensionality_reduction.html">Dimensionality Reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/model/feature_extractors.html">Feature Extractors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/model/filters.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/model/layers.html">Layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/model/sampling.html">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../reference_guide/api/model/stats.html">Stats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/api/post_processing.html">Post Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/api/metrics.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/api/loggers.html">Loggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/api/sweep.html">Sweep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/api/callbacks.html">Callbacks</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../reference_guide/algorithms/index.html">Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/cflow.html">CFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/dfkde.html">DFKDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/dfm.html">DFM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/draem.html">Draem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/fastflow.html">Fast-Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/ganomaly.html">GANomaly</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/padim.html">Padim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/patchcore.html">PatchCore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/reverse_distillation.html">Reverse Distillation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference_guide/algorithms/stfpm.html">STFPM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../developer_guide/index.html">Developer Guide</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer_guide/getting_started.html">Getting Started with Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer_guide/pre_commit_hooks.html">Pre-commit Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer_guide/using_tox.html">Using Tox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer_guide/developing_on_docker.html">Developing on Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer_guide/developing_on_docker.html#build-the-docker-image">Build the Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer_guide/developing_on_docker.html#run-the-docker-image">Run the Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer_guide/developing_on_docker.html#using-vscode">Using VSCode</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Simulation-of-production-line-with-defects---Dataset-creation-and-Inference">
<h1>Simulation of production line with defects - Dataset creation and Inference<a class="headerlink" href="#Simulation-of-production-line-with-defects---Dataset-creation-and-Inference" title="Permalink to this heading">¶</a></h1>
<p><em>This notebook is originally created by [&#64;paularamos](https://github.com/paularamo) for CVPR-2022 Tutorial</em><a class="reference external" href="https://paularamo.github.io/cvpr-2022/">How to get quick and performant model for your edge application. From data to application</a></p>
<section id="Definitions">
<h2>Definitions<a class="headerlink" href="#Definitions" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/openvinotoolkit/anomalib">Anomalib</a>: Anomalib is a deep learning library that aims to collect state-of-the-art anomaly detection algorithms for benchmarking on both public and private datasets. Anomalib provides several ready-to-use implementations of anomaly detection algorithms described in the recent literature, as well as a set of tools that facilitate the development and implementation of custom models. The library has a strong focus on image-based anomaly detection,
where the goal of the algorithm is to identify anomalous images, or anomalous pixel regions within images in a dataset.</p>
<p><a class="reference external" href="https://en.dobot.cn/products/education/magician.html">Dobot</a> The Magician is an education robot arm portable and capable to run various automation tasks. With an interface in C++ and python we can control the robot using this notebook.</p>
<blockquote>
<div><p>NOTE: If you don’t have the robot you can replace it by your custom problem.</p>
</div></blockquote>
</section>
<section id="Use-case">
<h2>Use case<a class="headerlink" href="#Use-case" title="Permalink to this heading">¶</a></h2>
<p>Using the <a class="reference external" href="https://www.dobot.cc/dobot-magician/product-overview.html">Dobot Magician</a> we could simulate a production line system. Imagine we have a cubes factory and they need to know when a defect piece appear in the process. We know very well what the aspect ratio of the normal cubes is. Defects are coming no often and we need to put those defect cubes out of the production line.</p>
<p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174126337-b344bbdc-6343-4d85-93e8-0cb1bf39a4e3.png" /></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Class</p></th>
<th class="head"><p>Yellow cube</p></th>
<th class="head"><p>Red cube</p></th>
<th class="head"><p>Green cube</p></th>
<th class="head"><p>Inferencing using Anomalib</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Normal</p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174083561-38eec918-efc2-4ceb-99b1-bbb4c91396b2.jpg" /></p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174083638-85ff889c-6222-4428-9c7d-9ad62bd15afe.jpg" /></p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174083707-364177d4-373b-4891-96ce-3e5ea923e440.jpg" /></p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174129305-03d9b71c-dfd9-492f-b42e-01c5c24171cc.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>Abnormal</p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174083805-df0a0b03-58c7-4ba8-af50-fd94d3a13e58.jpg" /></p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174083873-22699523-22b4-4a55-a3da-6520095af8af.jpg" /></p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174083944-38d5a6f4-f647-455b-ba4e-69482dfa3562.jpg" /></p></td>
<td><p><img alt="drawing" src="https://user-images.githubusercontent.com/10940214/174129253-f7a567d0-84f7-4050-8065-f00ba8bb973d.jpg" /></p></td>
</tr>
</tbody>
</table>
</div>
<p>Using Anomalib we are expecting to see this result.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Anomalib imports</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">time</span>  <span class="c1"># time library</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>

<span class="c1"># importing required libraries</span>
<span class="kn">import</span> <span class="nn">cv2</span>  <span class="c1"># OpenCV library</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">anomalib.deploy</span> <span class="kn">import</span> <span class="n">OpenVINOInferencer</span>
</pre></div>
</div>
</div>
<section id="Download-dataset-and-Robot-API/Driver">
<h3>Download dataset and Robot API/Driver<a class="headerlink" href="#Download-dataset-and-Robot-API/Driver" title="Permalink to this heading">¶</a></h3>
<p>We should prepare the folder to save the dataset and the Dobot API and drivers</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nth_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nth_dir</span> <span class="o">=</span> <span class="n">nth_dir</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">nth_dir</span>


<span class="c1"># Prepare the path to save the new image and the anomalib results</span>
<span class="n">current_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current directory: &quot;</span><span class="p">,</span> <span class="n">current_directory</span><span class="p">)</span>
<span class="n">working_path</span> <span class="o">=</span> <span class="n">up</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">current_directory</span><span class="p">)</span>  <span class="c1"># looking for anomalib folder</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Working directory: &quot;</span><span class="p">,</span> <span class="n">working_path</span><span class="p">)</span>
<span class="n">dataset_path</span> <span class="o">=</span> <span class="n">working_path</span> <span class="o">/</span> <span class="s2">&quot;datasets&quot;</span> <span class="o">/</span> <span class="s2">&quot;cubes&quot;</span>
<span class="n">dataset_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset directory: &quot;</span><span class="p">,</span> <span class="n">dataset_path</span><span class="p">)</span>
<span class="n">notebook_path</span> <span class="o">=</span> <span class="n">current_directory</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Notebook directory: &quot;</span><span class="p">,</span> <span class="n">notebook_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current directory:  /home/ashwin/projects/anomalib/notebooks/500_use_cases/501_dobot
Working directory:  /home/ashwin/projects/anomalib
Dataset directory:  /home/ashwin/projects/anomalib/datasets/cubes
Notebook directory:  /home/ashwin/projects/anomalib/notebooks/500_use_cases/501_dobot
</pre></div></div>
</div>
<p>We now need to download the Dobot API and cubes dataset captured via the Dobot Magician.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">download_and_extract_zip</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download and extract a zip file.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): URL to the zip file.</span>
<span class="sd">        path (str | Path | None, optional): Path to download and extract the zip</span>
<span class="sd">            file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.zip&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span> <span class="o">/</span> <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>


<span class="n">download_and_extract_zip</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://github.com/openvinotoolkit/anomalib/releases/download/dobot/dobot_api.zip&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="n">notebook_path</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">download_and_extract_zip</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://github.com/openvinotoolkit/anomalib/releases/download/dobot/cubes.zip&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">working_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/datasets&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note: If you are using the Dobot, don forget to move the dobot_api files to the notebook_path directly.</p>
</section>
</section>
<section id="Helper-funtions">
<h2>Helper funtions<a class="headerlink" href="#Helper-funtions" title="Permalink to this heading">¶</a></h2>
<p>Here you will find funtions to create filenames, capture images, run the inference and read the confidence of the detection.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filename_fc</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset_root</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the filename for new data(images)</span>

<span class="sd">    Args:</span>
<span class="sd">        root (Path): directory to save the new images in</span>
<span class="sd">            acquisition mode (abnormal or normal)</span>
<span class="sd">            dataset_path: Initial path to save new images and results</span>

<span class="sd">    Returns:</span>
<span class="sd">            str: captured image filename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">root</span> <span class="o">==</span> <span class="s2">&quot;abnormal&quot;</span><span class="p">:</span>
        <span class="c1"># check if a directory exists</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">dataset_root</span> <span class="o">/</span> <span class="s2">&quot;abnormal&quot;</span>
        <span class="c1"># Create a new directory if it does not exist</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;/input_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">root</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>
        <span class="c1"># check if a directory exists</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">dataset_root</span> <span class="o">/</span> <span class="s2">&quot;normal&quot;</span>
        <span class="c1"># Create a new directory if it does not exist</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;/input_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_name</span>
</pre></div>
</div>
</div>
</section>
<section id="Prepare-the-mode-(acquisition-or-inference-mode)-and-define-the-work-directory">
<h2>Prepare the mode (acquisition or inference mode) and define the work directory<a class="headerlink" href="#Prepare-the-mode-(acquisition-or-inference-mode)-and-define-the-work-directory" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Acquisition mode</span>
<span class="n">acquisition</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># True False</span>
<span class="n">source</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of the camera you want to use</span>
<span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;abnormal&quot;</span>  <span class="c1"># normal or abnormal</span>

<span class="c1"># If acquisition is False this notebook will work in inference mode</span>
<span class="k">if</span> <span class="n">acquisition</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="c1"># If you are running inference check where the OpenVINO model is stored</span>
    <span class="n">CONFIG_PATH</span> <span class="o">=</span> <span class="n">notebook_path</span> <span class="o">/</span> <span class="s2">&quot;cubes_config.yaml&quot;</span>
    <span class="n">openvino_model_path</span> <span class="o">=</span> <span class="n">notebook_path</span> <span class="o">/</span> <span class="s2">&quot;openvino&quot;</span> <span class="o">/</span> <span class="s2">&quot;model.bin&quot;</span>
    <span class="n">metadata_path</span> <span class="o">=</span> <span class="n">notebook_path</span> <span class="o">/</span> <span class="s2">&quot;openvino&quot;</span> <span class="o">/</span> <span class="s2">&quot;meta_data.json&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OpenVINO model exist: &quot;</span><span class="p">,</span> <span class="n">openvino_model_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OpenVINO path: &quot;</span><span class="p">,</span> <span class="n">openvino_model_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Metadata model exist: &quot;</span><span class="p">,</span> <span class="n">metadata_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Metadata path: &quot;</span><span class="p">,</span> <span class="n">metadata_path</span><span class="p">)</span>

    <span class="n">inferencer</span> <span class="o">=</span> <span class="n">OpenVINOInferencer</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">CONFIG_PATH</span><span class="p">,</span>  <span class="c1"># Pass the config file to the inferencer.</span>
        <span class="n">path</span><span class="o">=</span><span class="n">openvino_model_path</span><span class="p">,</span>  <span class="c1"># Path to the OpenVINO IR model.</span>
        <span class="n">meta_data_path</span><span class="o">=</span><span class="n">metadata_path</span><span class="p">,</span>  <span class="c1"># Path to the metadata file.</span>
        <span class="n">device</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span>  <span class="c1"># We would like to run it on an Intel CPU.</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">dataset_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Make sure you have the dataset in a proper folder or it i already created&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">dataset_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Helper-class-for-implementing-multi-threading">
<h2>Helper class for implementing multi-threading<a class="headerlink" href="#Helper-class-for-implementing-multi-threading" title="Permalink to this heading">¶</a></h2>
<p>Using multi-threading we will open the video to auto-capture an image when the robot locates the cube in front of the camera.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CameraStream</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class for implementing multi-threading.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">=</span> <span class="n">stream_id</span>

        <span class="c1"># opening video capture stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_capture</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Exiting]: Error accessing cam stream.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">fps_input_stream</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># hardware fps</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FPS of input stream: </span><span class="si">{</span><span class="n">fps_input_stream</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># reading a single frame from vcap stream for initializing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grabbed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_capture</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grabbed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Exiting] No more frames to read&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># self.stopped is initialized to False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># thread instantiation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># daemon threads run in background</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to start thread.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method passed to thread to read next available frame.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grabbed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_capture</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grabbed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Exiting] No more frames to read&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video_capture</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to return latest read frame.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to stop reading frames.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</section>
<section id="Function-to-visualize-the-prediction">
<h2>Function to visualize the prediction<a class="headerlink" href="#Function-to-visualize-the-prediction" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">visualize</span><span class="p">(</span><span class="n">prediction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function for visuzaling the predictions in inference mode&quot;&quot;&quot;</span>

    <span class="c1"># create figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># setting values to rows and column variables</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="c1"># Adds a subplot at the 1st position</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># showing image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>

    <span class="c1"># Adds a subplot at the 2nd position</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># showing image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">anomaly_map</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Anomaly Map&quot;</span><span class="p">)</span>

    <span class="c1"># Adds a subplot at the 3rd position</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># showing image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">heat_map</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Heat Map&quot;</span><span class="p">)</span>

    <span class="c1"># Adds a subplot at the 4th position</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># showing image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">pred_mask</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Pred. Mask&quot;</span><span class="p">)</span>

    <span class="c1"># Adds a subplot at the 4th position</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1"># showing image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">segmentations</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Result&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Using-a-webcam-or-a-USB-camera-for-running-the-inference">
<h2>Using a webcam or a USB camera for running the inference<a class="headerlink" href="#Using-a-webcam-or-a-USB-camera-for-running-the-inference" title="Permalink to this heading">¶</a></h2>
<p>Connect and identify your US camera, we will use a a video player to embed the video in this notebook.</p>
<blockquote>
<div><p>NOTE: If you don’t have the robot you can replace it by your custom problem. See the comments below.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dobot/general imports</span>
<span class="c1"># pylint: disable=wrong-import-order</span>
<span class="kn">import</span> <span class="nn">DobotDllType</span> <span class="k">as</span> <span class="nn">dType</span>  <span class="c1"># comment this line if you don&#39;t have the Dobot Magician</span>

<span class="n">CON_STR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">DobotConnect</span><span class="o">.</span><span class="n">DobotConnect_NoError</span><span class="p">:</span> <span class="s2">&quot;DobotConnect_NoError&quot;</span><span class="p">,</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">DobotConnect</span><span class="o">.</span><span class="n">DobotConnect_NotFound</span><span class="p">:</span> <span class="s2">&quot;DobotConnect_NotFound&quot;</span><span class="p">,</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">DobotConnect</span><span class="o">.</span><span class="n">DobotConnect_Occupied</span><span class="p">:</span> <span class="s2">&quot;DobotConnect_Occupied&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Load Dll and get the CDLL object</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">dType</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># Connect Dobot</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">dType</span><span class="o">.</span><span class="n">ConnectDobot</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">115200</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connect status:&quot;</span><span class="p">,</span> <span class="n">CON_STR</span><span class="p">[</span><span class="n">state</span><span class="p">])</span>

<span class="n">use_popup</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># True</span>

<span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">dType</span><span class="o">.</span><span class="n">DobotConnect</span><span class="o">.</span><span class="n">DobotConnect_NoError</span><span class="p">:</span>
    <span class="n">Calibration__0__Run__1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Calibration_X</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Calibration_Y</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Calibration_Z</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Place_X</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Place_Y</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Place_Z</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Anomaly_X</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Anomaly_Y</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Anomaly_Z</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">j</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">k</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">time_start</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;[HOME] Restore to home position at first launch, please wait 30 seconds after turnning on the Dobot Magician.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;[BLOCKS] Place them besides the non-motor side of the conveyor belt,&quot;</span>
        <span class="s2">&quot; the same side where the pick and place arm is.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[PLACING BLOCKS] Place the blocks by 3×3.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CALIBRATION POINT] Looking from the back of Dobot, the top left block is the calibration point.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CALIBRATION] Set the first variable to 0 to test the calibration point, then set 1 to start running.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;[DIRECTION] Standing behind Dobot Magician facing its front direction, X is front and back direction, &quot;</span>
        <span class="s2">&quot;Y is left and right direction. &quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[CONNECTION] Motor of the conveyor belt connects to port Stepper1.&quot;</span><span class="p">)</span>

    <span class="n">Calibration__0__Run__1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Calibration_X</span> <span class="o">=</span> <span class="mf">221.2288</span>
    <span class="n">Calibration_Y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">117.0036</span>
    <span class="n">Calibration_Z</span> <span class="o">=</span> <span class="o">-</span><span class="mf">42.3512</span>
    <span class="n">Place_X</span> <span class="o">=</span> <span class="mf">23.7489</span>  <span class="c1"># 42.2995 #</span>
    <span class="n">Place_Y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">264.2602</span>  <span class="c1"># -264.6927 #</span>
    <span class="n">Place_Z</span> <span class="o">=</span> <span class="mf">18.0862</span>  <span class="c1"># 63.65 #</span>
    <span class="n">Anomaly_X</span> <span class="o">=</span> <span class="o">-</span><span class="mi">112</span>  <span class="c1"># -84.287 #</span>
    <span class="n">Anomaly_Y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">170</span>  <span class="c1"># -170.454 #</span>
    <span class="n">Anomaly_Z</span> <span class="o">=</span> <span class="mi">90</span>  <span class="c1"># 61.5359 #</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">SetEndEffectorParamsEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mf">59.7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPJointParamsEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCommonParamsEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPJumpParamsEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Calibration_X</span><span class="p">,</span> <span class="n">Calibration_Y</span><span class="p">,</span> <span class="n">Calibration_Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">SetEndEffectorSuctionCupEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">STEP_PER_CRICLE</span> <span class="o">=</span> <span class="mf">360.0</span> <span class="o">/</span> <span class="mf">1.8</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="mf">16.0</span>
    <span class="n">MM_PER_CRICLE</span> <span class="o">=</span> <span class="mf">3.1415926535898</span> <span class="o">*</span> <span class="mf">36.0</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">STEP_PER_CRICLE</span> <span class="o">/</span> <span class="n">MM_PER_CRICLE</span>
    <span class="n">dType</span><span class="o">.</span><span class="n">SetEMotorEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">vel</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">Calibration__0__Run__1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="c1"># initializing and starting multi-threaded webcam input stream</span>
            <span class="n">cam_stream</span> <span class="o">=</span> <span class="n">CameraStream</span><span class="p">(</span><span class="n">stream_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># 0 id for main camera</span>
            <span class="n">cam_stream</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">Calibration_X</span> <span class="o">-</span> <span class="n">j</span><span class="p">),</span> <span class="p">(</span><span class="n">Calibration_Y</span> <span class="o">-</span> <span class="n">k</span><span class="p">),</span> <span class="p">(</span><span class="n">Calibration_Z</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dType</span><span class="o">.</span><span class="n">SetEndEffectorSuctionCupEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># dType.dSleep(150)</span>
            <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">Place_X</span> <span class="o">-</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">Place_Y</span> <span class="o">-</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">Place_Z</span> <span class="o">+</span> <span class="mi">90</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># adding a delay for simulating video processing time</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># delay value in seconds</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="c1"># Capture a frame from the video player - start thread</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">cam_stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">acquisition</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
                <span class="c1"># Get the inference results.</span>
                <span class="c1"># INFERENCE WITH OPENVINO</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">inferencer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">frame</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">pred_score</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">predictions</span><span class="o">.</span><span class="n">pred_score</span> <span class="o">&gt;</span> <span class="mf">0.48</span><span class="p">:</span>  <span class="c1"># modify the threshold depending of your needs</span>
                    <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Anomaly_X</span><span class="p">,</span> <span class="n">Anomaly_Y</span><span class="p">,</span> <span class="n">Anomaly_Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># define point for abnormalities</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Place_X</span><span class="p">,</span> <span class="n">Place_Y</span><span class="p">,</span> <span class="n">Place_Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># visualize(predictions)</span>

            <span class="k">if</span> <span class="n">acquisition</span><span class="p">:</span>
                <span class="c1"># create filename to next frame</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_fc</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">dataset_path</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
                <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Place_X</span><span class="p">,</span> <span class="n">Place_Y</span><span class="p">,</span> <span class="n">Place_Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># print(&quot;continue in the conveyor belt&quot;)</span>

            <span class="n">dType</span><span class="o">.</span><span class="n">SetEndEffectorSuctionCupEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># dType.dSleep(150)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">25</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">75</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">25</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">time_start</span> <span class="o">=</span> <span class="n">dType</span><span class="o">.</span><span class="n">gettime</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">STEP_PER_CRICLE</span> <span class="o">=</span> <span class="mf">360.0</span> <span class="o">/</span> <span class="mf">1.8</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="mf">16.0</span>
            <span class="n">MM_PER_CRICLE</span> <span class="o">=</span> <span class="mf">3.1415926535898</span> <span class="o">*</span> <span class="mf">36.0</span>
            <span class="n">vel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="n">STEP_PER_CRICLE</span> <span class="o">/</span> <span class="n">MM_PER_CRICLE</span>
            <span class="n">dType</span><span class="o">.</span><span class="n">SetEMotorEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">vel</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dType</span><span class="o">.</span><span class="n">gettime</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">time_start</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># Time over conveyor belt</span>
                    <span class="n">STEP_PER_CRICLE</span> <span class="o">=</span> <span class="mf">360.0</span> <span class="o">/</span> <span class="mf">1.8</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="mf">16.0</span>
                    <span class="n">MM_PER_CRICLE</span> <span class="o">=</span> <span class="mf">3.1415926535898</span> <span class="o">*</span> <span class="mf">36.0</span>
                    <span class="n">vel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">STEP_PER_CRICLE</span> <span class="o">/</span> <span class="n">MM_PER_CRICLE</span>
                    <span class="n">dType</span><span class="o">.</span><span class="n">SetEMotorEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">vel</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="n">dType</span><span class="o">.</span><span class="n">SetEndEffectorSuctionCupEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dType</span><span class="o">.</span><span class="n">SetPTPCmdEx</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Calibration_X</span><span class="p">,</span> <span class="n">Calibration_Y</span><span class="p">,</span> <span class="n">Calibration_Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cam_stream</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>  <span class="c1"># stop the webcam stream</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Simulation of production line with defects - Dataset creation and Inference</a><ul>
<li><a class="reference internal" href="#Definitions">Definitions</a></li>
<li><a class="reference internal" href="#Use-case">Use case</a><ul>
<li><a class="reference internal" href="#Download-dataset-and-Robot-API/Driver">Download dataset and Robot API/Driver</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Helper-funtions">Helper funtions</a></li>
<li><a class="reference internal" href="#Prepare-the-mode-(acquisition-or-inference-mode)-and-define-the-work-directory">Prepare the mode (acquisition or inference mode) and define the work directory</a></li>
<li><a class="reference internal" href="#Helper-class-for-implementing-multi-threading">Helper class for implementing multi-threading</a></li>
<li><a class="reference internal" href="#Function-to-visualize-the-prediction">Function to visualize the prediction</a></li>
<li><a class="reference internal" href="#Using-a-webcam-or-a-USB-camera-for-running-the-inference">Using a webcam or a USB camera for running the inference</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>