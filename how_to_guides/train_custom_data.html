<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Adding a New Model to Anomalib" href="adding_a_new_model.html" /><link rel="prev" title="How to Guides" href="index.html" />

    <link rel="shortcut icon" href="../_static/anomalib-favicon.png"/><meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>Training with Custom Data - Anomalib v0.4.0dev</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Anomalib v0.4.0dev</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/anomalib-icon.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/training.html">Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/inference.html">Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/export.html">Export &amp; Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/benchmarking.html">Benchmarking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/hyperparameter_optimization.html">Hyperparameter Optimization</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">How to Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Training with Custom Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_a_new_model.html">Adding a New Model to Anomalib</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/100_datamodules/101_btech.html">Use BeanTech Dataset via API</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/100_datamodules/102_mvtec.html">Use MVTec AD Dataset via API</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/100_datamodules/103_folder.html">Use Folder Dataset (for Custom Datasets) via API</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/100_datamodules/104_tiling.html">Tiling Large Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/200_models/201_fastflow.html">Train a Model via API</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/300_benchmarking/301_benchmarking.html">Short walkthrough on Benchmarking in Anomalib</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/300_benchmarking/302_hpo_wandb.html">Walkthrough on Hyperparameter Optimization using Weights and Biases</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/400_openvino/nncf.html">int-8 Model Quantization via NNCF</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference_guide/index.html">Reference Guide</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference_guide/api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/api/cli.html">CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/api/config.html">Configuration</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference_guide/api/data/index.html">Dataset</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/data/btech.html">Btech Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/data/mvtec.html">MVTec Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/data/folder.html">Folder Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/data/utils.html">Utils</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../reference_guide/api/model/index.html">Model</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/model/base.html">Base Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/model/dimensionality_reduction.html">Dimensionality Reduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/model/feature_extractors.html">Feature Extractors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/model/filters.html">Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/model/layers.html">Layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/model/sampling.html">Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference_guide/api/model/stats.html">Stats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/api/post_processing.html">Post Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/api/metrics.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/api/loggers.html">Loggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/api/sweep.html">Sweep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/api/callbacks.html">Callbacks</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference_guide/algorithms/index.html">Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/cflow.html">CFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/dfkde.html">DFKDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/dfm.html">DFM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/draem.html">Draem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/fastflow.html">Fast-Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/ganomaly.html">GANomaly</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/padim.html">Padim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/patchcore.html">PatchCore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/reverse_distillation.html">Reverse Distillation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_guide/algorithms/stfpm.html">STFPM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer_guide/index.html">Developer Guide</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer_guide/getting_started.html">Getting Started with Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer_guide/pre_commit_hooks.html">Pre-commit Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer_guide/using_tox.html">Using Tox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer_guide/developing_on_docker.html">Developing on Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer_guide/developing_on_docker.html#build-the-docker-image">Build the Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer_guide/developing_on_docker.html#run-the-docker-image">Run the Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer_guide/developing_on_docker.html#using-vscode">Using VSCode</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="training-with-custom-data">
<h1>Training with Custom Data<a class="headerlink" href="#training-with-custom-data" title="Permalink to this heading">¶</a></h1>
<p>Anomalib supports a number of datasets in various formats, including the state-of-the-art anomaly detection benchmarks such as MVTec AD and BeanTech. For those who would like to use the library on their custom datasets, anomalib also provides a <code class="docutils literal notranslate"><span class="pre">Folder</span></code> datamodule that can load datasets from a folder on a file system. The scope of this post will be to train anomalib models on custom datasets using the <code class="docutils literal notranslate"><span class="pre">Folder</span></code> datamodule.</p>
<section id="step-1-install-anomalib">
<h2>Step 1: Install Anomalib<a class="headerlink" href="#step-1-install-anomalib" title="Permalink to this heading">¶</a></h2>
<section id="option-1-pypi">
<h3>Option - 1 : PyPI<a class="headerlink" href="#option-1-pypi" title="Permalink to this heading">¶</a></h3>
<p>Anomalib can be installed from PyPI via the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>anomalib
</pre></div>
</div>
</section>
<section id="option-2-editable-install">
<h3>Option - 2: Editable Install<a class="headerlink" href="#option-2-editable-install" title="Permalink to this heading">¶</a></h3>
<p>Alternatively, it is also possible to do editable install:</p>
</section>
</section>
<section id="step-2-collect-your-custom-dataset">
<span id="collect-your-custom-dataset"></span><h2>Step 2: Collect Your Custom Dataset<a class="headerlink" href="#step-2-collect-your-custom-dataset" title="Permalink to this heading">¶</a></h2>
<p>Anomalib supports multiple image extensions such as <code class="docutils literal notranslate"><span class="pre">&quot;.jpg&quot;,</span> <span class="pre">&quot;.jpeg&quot;,</span> <span class="pre">&quot;.png&quot;,</span> <span class="pre">&quot;.ppm&quot;,</span> <span class="pre">&quot;.bmp&quot;,</span> <span class="pre">&quot;.pgm&quot;,</span> <span class="pre">&quot;.tif&quot;,</span> <span class="pre">&quot;.tiff&quot;,</span> <span class="pre">and</span> <span class="pre">&quot;.webp&quot;</span></code>. A dataset can be collected from images that have any of these extensions.</p>
</section>
<section id="step-3-format-your-dataset">
<h2>Step 3: Format your dataset<a class="headerlink" href="#step-3-format-your-dataset" title="Permalink to this heading">¶</a></h2>
<p>Depending on the use-case and collection, custom datasets can have different formats, some of which are listed below:</p>
<ul class="simple">
<li><p>A dataset with good and bad images.</p></li>
<li><p>A dataset with good and bad images as well as mask ground-truths for pixel-wise evaluation.</p></li>
<li><p>A dataset with good and bad images that is already split into training and testing sets.</p></li>
</ul>
<p>Each of these use-cases is addressed by anomalib’s <code class="docutils literal notranslate"><span class="pre">Folder</span></code> datamodule. Let’s focus on the first use-case as an example of end-to-end model training and inference. In this post, we will use the <a class="reference internal" href="../data/hazelnut_toy.html#hazelnut-toy-dataset"><span class="std std-ref">Hazelnut Toy</span></a> dataset which you can download from <a class="reference external" href="https://openvinotoolkit.github.io/anomalib/_downloads/3f2af1d7748194b18c2177a34c03a2c4/hazelnut_toy.zip">here</a>. The dataset consists of several folders, each containing a set of images. The <code class="docutils literal notranslate"><span class="pre">colour</span></code> and the <code class="docutils literal notranslate"><span class="pre">crack</span></code> folders represent two kinds of defects. We can ignore the <code class="docutils literal notranslate"><span class="pre">masks</span></code> folder for now.</p>
<p>Load your data to the following directory structure. Anomalib will use all images in the <code class="docutils literal notranslate"><span class="pre">colour</span></code> folder as part of the validation dataset and then randomly split the good images for training and validation.</p>
</section>
<section id="step-4-modify-config-file">
<h2>Step 4: Modify Config File<a class="headerlink" href="#step-4-modify-config-file" title="Permalink to this heading">¶</a></h2>
<p>A YAML configuration file is necessary to run training for Anomalib. The training configuration parameters are categorized into 5 sections: <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, <code class="docutils literal notranslate"><span class="pre">logging</span></code>, <code class="docutils literal notranslate"><span class="pre">trainer</span></code>.</p>
<p>To get Anomalib functionally working with a custom dataset, one only needs to change the <code class="docutils literal notranslate"><span class="pre">dataset</span></code> section of the configuration file.</p>
<p>Below is an example of what the dataset parameters would look like for our <code class="docutils literal notranslate"><span class="pre">hazelnut_toy</span></code> folder specified in <a class="reference internal" href="#collect-your-custom-dataset"><span class="std std-ref">Step 2</span></a>.</p>
<p>Let’s choose <a class="reference external" href="https://arxiv.org/pdf/2011.08785.pdf">Padim algorithm</a>, copy the sample config and modify the dataset section.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>anomalib/models/padim/config.yaml<span class="w"> </span>custom_padim.yaml
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace the dataset configs with the following.</span>
<span class="nt">dataset</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hazelnut</span>
<span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">folder</span>
<span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./datasets/Hazelnut_toy</span>
<span class="nt">normal_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">good</span><span class="w"> </span><span class="c1"># name of the folder containing normal images.</span>
<span class="nt">abnormal_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">colour</span><span class="w"> </span><span class="c1"># name of the folder containing abnormal images.</span>
<span class="nt">task</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">classification</span><span class="w"> </span><span class="c1"># classification or segmentation</span>
<span class="nt">mask_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1">#optional</span>
<span class="nt">normal_test_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># optional</span>
<span class="nt">extensions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="nt">split_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">  </span><span class="c1"># normal images ratio to create a test split</span>
<span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">image_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
<span class="nt">train_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="nt">eval_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="nt">num_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="nt">transform_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">train</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">eval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="nt">val_split_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">from_test</span><span class="w"> </span><span class="c1"># determines how the validation set is created, options [same_as_test, from_test]</span>
<span class="nt">tiling</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">tile_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">stride</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">remove_border_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">use_random_tiling</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">random_tile_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>

<span class="nt">model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">padim</span>
<span class="w">    </span><span class="nt">backbone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resnet18</span>
<span class="w">    </span><span class="nt">layer</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">layer1</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</section>
<section id="step-5-run-training">
<h2>Step 5: Run Training<a class="headerlink" href="#step-5-run-training" title="Permalink to this heading">¶</a></h2>
<p>As per the config file, move <code class="docutils literal notranslate"><span class="pre">Hazelnut_toy</span></code> to the datasets section in the main root directory of anomalib, and then run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>tools/train.py<span class="w"> </span>--config<span class="w"> </span>custom_padim.yaml
</pre></div>
</div>
</section>
<section id="step-6-interpret-results">
<h2>Step 6: Interpret Results<a class="headerlink" href="#step-6-interpret-results" title="Permalink to this heading">¶</a></h2>
<p>Anomalib will print out results of the trained model on the validation dataset. The printed metrics are dependent on the task mode chosen. The classification example provided in this tutorial prints out two scores: F1 and AUROC. The F1 score is a metric which values both the precision and recall, more information on its calculation can be found in this <a class="reference external" href="https://towardsdatascience.com/understanding-accuracy-recall-precision-f1-scores-and-confusion-matrices-561e0f5e328c">blog</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not only does Anomalib classify whether a part is defected or not, it can also be used to segment the defects as well. To do this, simply add a folder called <code class="docutils literal notranslate"><span class="pre">mask</span></code> at the same directory level as the <code class="docutils literal notranslate"><span class="pre">good</span></code> and <code class="docutils literal notranslate"><span class="pre">colour</span></code> folders. This folder should contain binary images for the defects in the <code class="docutils literal notranslate"><span class="pre">colour</span></code> folder. Here, the white pixels represent the location of the defect. Populate the mask field in the config file with <code class="docutils literal notranslate"><span class="pre">mask</span></code> and change the task to segmentation to see Anomalib segment defects.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Hazelnut_toy
├──<span class="w"> </span>colour
│<span class="w">  </span>├──<span class="w"> </span><span class="m">00</span>.jpg
│<span class="w">  </span>├──<span class="w"> </span><span class="m">01</span>.jpg
│<span class="w">  </span>...
├──<span class="w"> </span>good
│<span class="w">  </span>├──<span class="w"> </span><span class="m">00</span>.jpg
│<span class="w">  </span>├──<span class="w"> </span><span class="m">01</span>.jpg
└──<span class="w"> </span>mask
├──<span class="w"> </span><span class="m">00</span>.jpg
├──<span class="w"> </span><span class="m">01</span>.jpg
...
</pre></div>
</div>
<p>Here is an example of the generated results for a toy dataset containing Hazelnut with colour defects.</p>
<img alt="../_images/hazelnut_results.gif" class="align-center" src="../_images/hazelnut_results.gif" />
</section>
<section id="logging-and-experiment-management">
<h2>Logging and Experiment Management<a class="headerlink" href="#logging-and-experiment-management" title="Permalink to this heading">¶</a></h2>
<p>While it is delightful to know how good your model performed on your preferred metric, it is even more exciting to see the predicted outputs. Anomalib provides a couple of ways to log and track experiments. These can be used individually or in a combination. As of the current release, you can save images to a local folder, or upload to comet, weights and biases, or TensorBoard.</p>
<p>To select where you would like to save the images, change the <code class="docutils literal notranslate"><span class="pre">log_images</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">Visualization</span></code> section in the config file to true.</p>
<p>For example, setting the following <code class="docutils literal notranslate"><span class="pre">log_images:</span> <span class="pre">True</span></code> will result in saving the images in the results folder as shown in the tree structure below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>results
└──<span class="w"> </span>padim
<span class="w">    </span>└──<span class="w"> </span>Hazelnut_toy
<span class="w">        </span>├──<span class="w"> </span>images
<span class="w">        </span>│<span class="w">   </span>├──<span class="w"> </span>colour
<span class="w">        </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span><span class="m">00</span>.jpg
<span class="w">        </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span><span class="m">01</span>.jpg
<span class="w">        </span>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>...
<span class="w">        </span>│<span class="w">   </span>└──<span class="w"> </span>good
<span class="w">        </span>│<span class="w">       </span>├──<span class="w"> </span><span class="m">00</span>.jpg
<span class="w">        </span>│<span class="w">       </span>├──<span class="w"> </span><span class="m">01</span>.jpg
<span class="w">        </span>│<span class="w">       </span>└──<span class="w"> </span>...
<span class="w">        </span>└──<span class="w"> </span>weights
<span class="w">            </span>└──<span class="w"> </span>model.ckpt
</pre></div>
</div>
<section id="logging-to-tensorboard-and-or-w-b">
<h3>Logging to Tensorboard and/or W&amp;B<a class="headerlink" href="#logging-to-tensorboard-and-or-w-b" title="Permalink to this heading">¶</a></h3>
<p>To use TensorBoard and/or W&amp;B logger and/or Comet logger, ensure that the logger parameter is set to <code class="docutils literal notranslate"><span class="pre">comet</span></code>, <code class="docutils literal notranslate"><span class="pre">tensorboard</span></code>, <code class="docutils literal notranslate"><span class="pre">wandb</span></code> or <code class="docutils literal notranslate"><span class="pre">[tensorboard,</span> <span class="pre">wandb]</span></code> in the <code class="docutils literal notranslate"><span class="pre">logging</span></code> section of the config file.</p>
<p>An example configuration for saving to TensorBoard is shown in the figure below. Similarly after setting logger to <code class="docutils literal notranslate"><span class="pre">wandb</span></code> or ‘comet’ you will see the images on your wandb and/or comet project dashboard.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">visualization</span><span class="p">:</span>
<span class="w">    </span><span class="nt">show_images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># show images on the screen</span>
<span class="w">    </span><span class="nt">save_images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># save images to the file system</span>
<span class="w">    </span><span class="nt">log_images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"> </span><span class="c1"># log images to the available loggers (if any)</span>
<span class="w">    </span><span class="nt">image_save_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># path to which images will be saved</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full</span><span class="w"> </span><span class="c1"># options: [&quot;full&quot;, &quot;simple&quot;]</span>

<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">    </span><span class="nt">logger</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">comet</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tensorboard</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">wandb</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1">#Choose any combination of these 3</span>
<span class="w">    </span><span class="nt">log_graph</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<img alt="../_images/logging.gif" class="align-center" src="../_images/logging.gif" />
</section>
<section id="hyper-parameter-optimization">
<h3>Hyper-Parameter Optimization<a class="headerlink" href="#hyper-parameter-optimization" title="Permalink to this heading">¶</a></h3>
<p>It is very rare to find a model which works out of the box for a particular dataset. However, fortunately, we support tools which work out of the box to help tune the models in Anomalib to your particular dataset. As of the publication of this blog post, Anomalib supports <a class="reference external" href="https://wandb.ai/">weights and biases</a> for hyperparameter optimization. To get started have a look at <code class="docutils literal notranslate"><span class="pre">sweep.yaml</span></code> located at <code class="docutils literal notranslate"><span class="pre">tools/hpo</span></code>. It provides a sample of how one can define a hyperparameter sweep.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">observation_budget</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bayes</span>
<span class="nt">metric</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pixel_AUROC</span>
<span class="nt">goal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">maximize</span>
<span class="nt">parameters</span><span class="p">:</span>
<span class="nt">dataset</span><span class="p">:</span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hazelnut</span>
<span class="w">    </span><span class="nt">image_size</span><span class="p">:</span>
<span class="w">    </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">128</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">256</span><span class="p p-Indicator">]</span>
<span class="nt">model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">backbone</span><span class="p">:</span>
<span class="w">    </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">resnet18</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">wide_resnet50_2</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The observation_budget informs wandb about the number of experiments to run. The method section defines the kind of method to use for HPO search. For other available methods, have a look at <a class="reference external" href="https://docs.wandb.ai/guides/sweeps/quickstart">Weights and Biases</a> documentation. The parameters section contains dataset and model parameters. Any parameter defined here overrides the parameter in the original model configuration.</p>
<p>To run a sweep, you can just call,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>tools/hpo/wandb_sweep.py<span class="w">   </span><span class="se">\</span>
<span class="w">    </span>--model<span class="w"> </span>padim<span class="w">                   </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>./path_to_config.yaml<span class="w">  </span><span class="se">\</span>
<span class="w">    </span>--sweep_config<span class="w"> </span>tools/hpo/sweep.yaml
</pre></div>
</div>
<p>In case <code class="docutils literal notranslate"><span class="pre">model_config</span></code> is not provided, the script looks at the default config location for that model. Note, you will need to have logged into a wandb account to use HPO search and view the results.</p>
<p>A sample run is visible in the screenshot below.</p>
<img alt="../_images/hpo.gif" class="align-center" src="../_images/hpo.gif" />
</section>
</section>
<section id="benchmarking">
<h2>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this heading">¶</a></h2>
<p>To add to the suit of experiment tracking and optimization, anomalib also includes a benchmarking script for gathering results across different combinations of models, their parameters, and dataset categories. The model performance and throughputs are logged into a csv file that can also serve as a means to track model drift. Optionally, these same results can be logged to Weights and Biases and TensorBoard. A sample configuration file is shown in the screenshot below.</p>
<p>This configuration computes the throughput and performance metrics for CPU and GPU for two categories of the toy dataset for Padim and STFPM models. The dataset can be configured in the respective model configuration files. By default, <code class="docutils literal notranslate"><span class="pre">compute_openvino</span></code> is set to False to support instances where OpenVINO requirements are not installed in the environment. Once installed, this flag can be set to True to get throughput on OpenVINO optimized models. The writer parameter is optional and can be set to <code class="docutils literal notranslate"><span class="pre">writer:</span> <span class="pre">[]</span></code> in case the user only requires a csv file without logging to TensorBoard or Weights and Biases. It is also a good practice to set a value of seed to ensure reproducibility across runs and thus, is set to a non-zero value by default.</p>
<p>Once a configuration is decided, benchmarking can easily be performed by calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>tools/benchmarking/benchmark.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>tools/benchmarking/benchmark_params.yaml
</pre></div>
</div>
<p>A nice feature about the provided benchmarking script is that if the host system has multiple GPUs, the runs are parallelized over all the available GPUs for faster collection of result.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Intel researchers actively maintain the Anomalib repository. Their mission is to provide the AI community with best-in-class performance and accuracy while also providing a positive developer experience. Check out the repo and start using anomalib right away!</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="adding_a_new_model.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Adding a New Model to Anomalib</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">How to Guides</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Training with Custom Data</a><ul>
<li><a class="reference internal" href="#step-1-install-anomalib">Step 1: Install Anomalib</a><ul>
<li><a class="reference internal" href="#option-1-pypi">Option - 1 : PyPI</a></li>
<li><a class="reference internal" href="#option-2-editable-install">Option - 2: Editable Install</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-2-collect-your-custom-dataset">Step 2: Collect Your Custom Dataset</a></li>
<li><a class="reference internal" href="#step-3-format-your-dataset">Step 3: Format your dataset</a></li>
<li><a class="reference internal" href="#step-4-modify-config-file">Step 4: Modify Config File</a></li>
<li><a class="reference internal" href="#step-5-run-training">Step 5: Run Training</a></li>
<li><a class="reference internal" href="#step-6-interpret-results">Step 6: Interpret Results</a></li>
<li><a class="reference internal" href="#logging-and-experiment-management">Logging and Experiment Management</a><ul>
<li><a class="reference internal" href="#logging-to-tensorboard-and-or-w-b">Logging to Tensorboard and/or W&amp;B</a></li>
<li><a class="reference internal" href="#hyper-parameter-optimization">Hyper-Parameter Optimization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#benchmarking">Benchmarking</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>